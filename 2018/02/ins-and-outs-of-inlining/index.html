<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="author" content="ÂàÄÂøÉ„ÅÆÊ∞¥">
<meta name="keywords" content=", visual, music, technology">
<meta name="description" content="Limit most inlining to small, frequently called functions to facilitate debugging and binary upgradability, minimize potential code bloat, and maximize the chances of greater program speed.">


<meta property="og:description" content="Limit most inlining to small, frequently called functions to facilitate debugging and binary upgradability, minimize potential code bloat, and maximize the chances of greater program speed.">
<meta property="og:type" content="article">
<meta property="og:title" content="Item-30 Understand ins and outs of inlining">
<meta name="twitter:title" content="Item-30 Understand ins and outs of inlining">
<meta property="og:url" content="http://nianze.tk/2018/02/ins-and-outs-of-inlining/">
<meta property="twitter:url" content="http://nianze.tk/2018/02/ins-and-outs-of-inlining/">
<meta property="og:site_name" content="Be creative">
<meta property="og:description" content="Limit most inlining to small, frequently called functions to facilitate debugging and binary upgradability, minimize potential code bloat, and maximize the chances of greater program speed.">
<meta name="twitter:description" content="Limit most inlining to small, frequently called functions to facilitate debugging and binary upgradability, minimize potential code bloat, and maximize the chances of greater program speed.">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2018-02-21T00:00:00">
  
  
    <meta property="article:modified_time" content="2018-02-21T00:00:00">
  
  
  
    
      <meta property="article:section" content="technology">
    
      <meta property="article:section" content="coding">
    
  
  
    
      <meta property="article:tag" content="technique">
    
      <meta property="article:tag" content="cpp">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="http://nianze.tk/images/2018/2018-02/2018-02-21.gif">
  <meta property="twitter:image" content="http://nianze.tk/images/2018/2018-02/2018-02-21.gif">





  <meta property="og:image" content="http://nianze.tk/images/bw.JPG">
  <meta property="twitter:image" content="http://nianze.tk/images/bw.JPG">


    <title>Item-30 Understand ins and outs of inlining</title>

    <link rel="icon" href="http://nianze.tk/favicon.png">
    

    

    <link rel="canonical" href="http://nianze.tk/2018/02/ins-and-outs-of-inlining/">

    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="http://nianze.tk/css/style-nnm2spxvve8onlujjlegkkytaehyadd4ksxc1hyzzq9a2wvtrgbljqyulomn.min.css" />
    
    
      
        <link rel="stylesheet" href="http://nianze.tk/css/main.css">
      
    
      
        <link rel="stylesheet" href="http://nianze.tk/css/loader.css">
      
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-71584380-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body id="container">
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fas fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="http://nianze.tk/">Be creative</a>
  </div>
  
    
      <a class="header-right-picture "
         href="http://nianze.tk/#about">
    
    
    
      
        <img class="header-picture" src="http://nianze.tk/images/bw.JPG" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="http://nianze.tk/#about">
          <img class="sidebar-profile-picture" src="http://nianze.tk/images/bw.JPG" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">ÂàÄÂøÉ„ÅÆÊ∞¥</h4>
        
          <h5 class="sidebar-profile-bio"><p>ËôöÂ∫¶Âªø‰ΩôÂ≤ÅÊúàÊµÖÔºåÁï•ËØÜÂá†Ë°å‰ª£Á†ÅÊ∫ê„ÄÇ<br />
Èó≤Êù•ÈöèÊâãÂø´Èó®ÊåâÔºåÊÄÜÁÑ∂Áã¨ÊääÈü≥ÈüµÂºπ„ÄÇ</p>

<p>Pain is inevitable.<br />
Suffering is optional.</p>
</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://nianze.tk/">
    
      <i class="sidebar-button-icon fas fa-home" title='Home'></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://nianze.tk/categories/thoughts">
    
      <i class="sidebar-button-icon fas fa-lightbulb" title='Thoughts'></i>
      
      <span class="sidebar-button-desc">Thoughts</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://nianze.tk/categories/technology">
    
      <i class="sidebar-button-icon fas fa-code" title='Technology'></i>
      
      <span class="sidebar-button-desc">Technology</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://nianze.tk/categories/music">
    
      <i class="sidebar-button-icon fas fa-music" title='Music'></i>
      
      <span class="sidebar-button-desc">Music</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://nianze.tk/categories/visual">
    
      <i class="sidebar-button-icon fas fa-palette" title='Visual'></i>
      
      <span class="sidebar-button-desc">Visual</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://nianze.tk/categories">
    
      <i class="sidebar-button-icon fas fa-bookmark" title='Categories'></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://nianze.tk/tags">
    
      <i class="sidebar-button-icon fas fa-tags" title='Tags'></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://nianze.tk/archives">
    
      <i class="sidebar-button-icon fas fa-archive" title='Archives'></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://nianze.tk/about">
    
      <i class="sidebar-button-icon fas fa-user" title='About'></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.linkedin.com/in/nianze" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-linkedin" title='LinkedIn'></i>
      
      <span class="sidebar-button-desc">LinkedIn</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/Nianze" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-github" title='Github'></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.flickr.com/photos/129774362@N07/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-flickr", title='Flickr'></i>
      
      <span class="sidebar-button-desc">Flickr</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://instagram.com/eznain" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-instagram" title='Instagram'></i>
      
      <span class="sidebar-button-desc">Instagram</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.facebook.com/rym.lnz" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-facebook", title='Facebook'></i>
      
      <span class="sidebar-button-desc">Facebook</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/daoxinzhishui" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-twitter", title='Twitter'></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.youtube.com/user/daoxinzhishui" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-youtube", title='YouTube'></i>
      
      <span class="sidebar-button-desc">YouTube</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="mailto:daoxinzhishui@gmail.com" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fas fa-envelope", title='Email'></i>
      
      <span class="sidebar-button-desc">Email</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://nianze.tk/post/index.xml">
    
      <i class="sidebar-button-icon fas fa-rss-square", title='RSS'></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      Item-30 Understand ins and outs of inlining
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2018-02-21T00:00:00Z">
        
  February 21, 2018

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="http://nianze.tk/categories/technology">technology</a>, 
    
      <a class="category-link" href="http://nianze.tk/categories/coding">coding</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>Limit most inlining to small, frequently called functions to facilitate debugging and binary upgradability, minimize potential code bloat, and maximize the chances of greater program speed.</p>

<h1 id="table-of-contents">Table of Contents</h1><nav id="TableOfContents">
<ul>
<li><a href="#performance-benifits">Performance benifits</a></li>
<li><a href="#details-on-inline-functions">Details on inline functions</a>
<ul>
<li><a href="#causes-of-un-inlined-inline-function">Causes of un-inlined inline function</a></li>
<li><a href="#inline-constructors-and-destructors">Inline constructors and destructors?</a></li>
</ul></li>
<li><a href="#other-costs-of-inlining">Other costs of inlining</a></li>
<li><a href="#to-inline-or-not-to-inline">To inline or not to inline?</a></li>
</ul>
</nav>

<h1 id="performance-benifits">Performance benifits</h1>

<p>Inline functions have some wonderful advantages:</p>

<ol>
<li>They act like functions.</li>
<li>Yet we call them without having to incur the overhead of a function call.</li>
<li>Compilers might perfom context-specific optimizations (such as stretches of the code) on the body of the inline function thanks to the lack &ldquo;outlined&rdquo; function call</li>
<li>If an inline function body is <em>very</em> short, the code generated for the function body may be smaller than the code generated for a function call, leading to <em>smaller</em> object code and a higher instruction cache hit rate.</li>
</ol>

<p>However, on the other hand, it is also likely to increase the size of our object code. Overzealous inlining can give rise to programs too big for the available space on machines with limited memory. Even with virtual memory, inline-induced code bloat can lead to additional paging, a reduced instruction cache hit rate, and the performance penalties that accompany these things.</p>

<h1 id="details-on-inline-functions">Details on inline functions</h1>

<p>There are two ways to give such a request: implicitly or explicitly:</p>

<ol>
<li><p>Implicitly inline request</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Person</span> {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    ...
    <span style="color:#66d9ef">int</span> age() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> theAge; } <span style="color:#75715e">// an implicit inline request
</span><span style="color:#75715e"></span>    ...
<span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">int</span> theAge;
};
</code></pre></div>
<p>Apart from the member functions, we can also define friend functions inside classes (item 46), resulting to implicitly inline declaration.</p></li>

<li><p>Explicitly inline request (and its relationship with template)</p>

<p>We can explicitly daclare an inline function with the <code>inline</code> keyword, such as how the standard <code>max</code> template from <code>&lt;algorithm&gt;</code> is implemeted:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">template</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">typename</span> T<span style="color:#f92672">&gt;</span>   <span style="color:#75715e">// an explicit inline
</span><span style="color:#75715e"></span><span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">const</span> T<span style="color:#f92672">&amp;</span> std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>max(<span style="color:#66d9ef">const</span> T<span style="color:#f92672">&amp;</span> a, <span style="color:#66d9ef">const</span> T<span style="color:#f92672">&amp;</span> b) <span style="color:#75715e">// request:: std::max is preceded by &#34;inline&#34;
</span><span style="color:#75715e"></span>{ <span style="color:#66d9ef">return</span> a <span style="color:#f92672">&lt;</span> b <span style="color:#f92672">?</span> b : a;}
</code></pre></div>
<p>It&rsquo;s true that both template and inline functions are typically defined in header files, but this doesn&rsquo;t mean that function templates must be inline. In fact, template instantiation is independent of inlining:</p>

<ul>
<li>inline functions must typically be in header files, because most build environments do inlining during compilation. In order to replace a function call with the body of the called function, compilers must know waht the function looks like <sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup>.</li>
<li>templates are typically in header file, because compilers need to know what a template looks like in order to instantiate it when it&rsquo;s used <sup class="footnote-ref" id="fnref:2"><a href="#fn:2">2</a></sup>.</li>
</ul>

<p>Thus, when we&rsquo;re writing a template:</p>

<ul>
<li>if we belive that all the functions instantiated from the template should be inlined, declare the template <code>inline</code> just like what&rsquo;s done with the <code>std::max</code> implamentation above;</li>
<li>if we have no reason to want inlined after considering its cost and potential code bloat (which is particularly important for template authors - see item 44), avoid declaring the template inline (either explicitly or implicitly)</li>
</ul></li>
</ol>

<h2 id="causes-of-un-inlined-inline-function">Causes of un-inlined inline function</h2>

<p>Bear in mind that <code>inline</code> is a <em>request</em> to compilers, rather than a command, so compilers may ignore it. Whether a given inline function is actually inlined depends on the build environment we&rsquo;re using - primarily on the compiler, and most compilers have a diagnostic level that will result in a warning (item 53) if they fail to inline a function we&rsquo;ve asked them to. When they refuse to inline a function, the typical reasons may be:</p>

<ol>
<li>compilers deem the function too complicated (e.g., those containing loogs or are recursive)</li>
<li>the function is virtual (<code>virtual</code> means runtime, while <code>inline</code> usually happens before execution)</li>

<li><p>when the program will take the address of an inline function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">f</span>(){...} <span style="color:#75715e">// assume compilers are willing to inline calls to f
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span>pf)() <span style="color:#f92672">=</span> f;    <span style="color:#75715e">// pf points to f
</span><span style="color:#75715e"></span>...
f();                 <span style="color:#75715e">// this call will be inlined, for it&#39;s a &#34;normal&#34; call
</span><span style="color:#75715e"></span>pf();                <span style="color:#75715e">// this call probably won&#39;t be, for it&#39;s through a function pointer
</span></code></pre></div></li>
</ol>

<h2 id="inline-constructors-and-destructors">Inline constructors and destructors?</h2>

<p>Note that even if we never use function pointers, sometimes compilers will generate those pointers: compilers may generate out-of-line copies of constructors and destructors so that they can get pointers to those functions for use during construction and destruction of objects in arrays. Let alone that constructors and destructors are often worse candidates of inlining than a casual examination would indicate:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Base</span> {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    ...
<span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
    std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string bm1, bm2;  <span style="color:#75715e">// base members 1 and 2
</span><span style="color:#75715e"></span>};
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Derived</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Base {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    Derived(){}   <span style="color:#75715e">// Derived&#39;s ctor is empty, or is it?
</span><span style="color:#75715e"></span>    ...
<span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
    std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string dm1, dm2, dm3;  <span style="color:#75715e">// derived members 1,2,3
</span><span style="color:#75715e"></span>}
</code></pre></div>
<p>The constructor of <code>Derived</code> seems empty, so it may seem a good candidate for inlining. But looks can be deceiving:</p>

<blockquote>
<p>C++ makes various guarantees about object construction and corresponding destruction. To name a few: when we create an object, each base class of and each data member in that object is automatically constructed; if an exception is thrown during construction, any parts of the object that have already been fully constructed are automatically destroyed. Similar but reverse process will occur when an object is destroyed.</p>
</blockquote>

<p>Therefore, in the example above, extra code will be generated by compilers and added into the empty <code>Derived</code> constructor in order to offer those guarantees, ending up with some code equivalent to the following conceptual implementation (the real one will certainly be more sophisticated):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">Derived<span style="color:#f92672">:</span><span style="color:#f92672">:</span>Derived()  <span style="color:#75715e">// conceptual impl. of &#34;empty&#34; Derived ctor
</span><span style="color:#75715e"></span>{
    Base<span style="color:#f92672">:</span><span style="color:#f92672">:</span>Base();  <span style="color:#75715e">// init. Base part
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">try</span> { dm1.std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string(); } <span style="color:#75715e">// try to construct dm1
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">catch</span> (...) {       <span style="color:#75715e">// if it throws
</span><span style="color:#75715e"></span>        Base<span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#f92672">~</span>Base();  <span style="color:#75715e">// destroy base class part and
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">throw</span>;          <span style="color:#75715e">// propagate the exception
</span><span style="color:#75715e"></span>    }

    <span style="color:#66d9ef">try</span> { dm2.std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string();} <span style="color:#75715e">// try to construct dm2
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">catch</span>(...) {                      <span style="color:#75715e">// if it throws
</span><span style="color:#75715e"></span>        dm1.std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string<span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#f92672">~</span>string();   <span style="color:#75715e">// destroy dm1,
</span><span style="color:#75715e"></span>        Base<span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#f92672">~</span>Base();                <span style="color:#75715e">// destroy base class part
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">throw</span>;                        <span style="color:#75715e">// and propagate the exception
</span><span style="color:#75715e"></span>    }

    <span style="color:#66d9ef">try</span> { dm3.std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string();}  <span style="color:#75715e">// try to construct dm3
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">catch</span>(...) {                       <span style="color:#75715e">// if it throws
</span><span style="color:#75715e"></span>        dm1.std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string<span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#f92672">~</span>string();    <span style="color:#75715e">// destroy dm1,
</span><span style="color:#75715e"></span>        dm1.std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string<span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#f92672">~</span>string();    <span style="color:#75715e">// destroy dm2,
</span><span style="color:#75715e"></span>        Base<span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#f92672">~</span>Base();                 <span style="color:#75715e">// destroy base class part
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">throw</span>;                         <span style="color:#75715e">// and propagate the exception
</span><span style="color:#75715e"></span>    }
}
</code></pre></div>
<p>The same reasoning applies to the <code>Base</code> constructor, so if <code>Base</code>&rsquo;s constructor is inlined, and <code>string</code> constructor also happens to be inlined, the <code>Derived</code> constructor will gain <em>five</em> copies of <code>string</code>&rsquo;s constructor, one for each of the five strings in a <code>Derived</code> object - that is a big code bloat. Similar considerations apply to <code>Derived</code>&rsquo;s destructor.</p>

<h1 id="other-costs-of-inlining">Other costs of inlining</h1>

<p>Apart from the cost of possible code bloat, there are other impact of declaring functions <code>inline</code>:</p>

<ol>
<li><strong>on binary upgradability</strong>: for library designers, it&rsquo;s impossible to provide binary upgrades to the client visible inline functions in a library, after clients of the library compile the body of <code>inline</code> function <code>f</code> into their application. Once the imlementation of <code>f</code> changes, all clients who&rsquo;ve used <code>f</code> must recompile.</li>
<li><strong>on debugging</strong>: most debuggers have trouble with inline functions: after all, it is hard to set a breakpoint in a function that isn&rsquo;t there<sup class="footnote-ref" id="fnref:3"><a href="#fn:3">3</a></sup>.</li>
</ol>

<h1 id="to-inline-or-not-to-inline">To inline or not to inline?</h1>

<p>In summary, the logical strategy of determining which functions should be declared inline and which should not:</p>

<ul>
<li>initially don&rsquo;t inline anything</li>
<li>detect those functions that must be inline (item 46) or are truly trivial (such as <code>Person::age</code> in this item), inline them cautiously as a hand-applied optimization</li>
<li>as the empirically determined rule of 80-20 suggests: identify the 20% of your code that can increase your program&rsquo;s overall performance, and try to tweak those critical functions with <code>inline</code> or other techniques</li>
</ul>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">There are exceptions: some build environments can inline during linking, and a few can actually inline at runtime (e.g., managed environments based on the .NET Common Language Infrastructure - <code>CLI</code>). Of course, such exceptions are not the rule, and inlining in most C++ programs is a compile-time activity.
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2">Again, some build environments perform template instantiation during linking. However, compile-time instantiation is more common.
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
<li id="fn:3">Some build environments manage to support debugging of inlined functions, but many environments simply disable inlining for debug builds.
 <a class="footnote-return" href="#fnref:3"><sup>[return]</sup></a></li>
</ol>
</div>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="http://nianze.tk/tags/technique/">technique</a>

  <a class="tag tag--primary tag--small" href="http://nianze.tk/tags/cpp/">cpp</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="http://nianze.tk/2018/02/minimize-compilation-dependencies-between-files/" data-tooltip="Item-31 Minimize compilation dependencies between files">
              
                  <i class="fas fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="http://nianze.tk/2018/02/strive-for-exception-safe-code/" data-tooltip="Item-29 Strive for exception-safe code">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fas fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fas fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://nianze.tk/2018/02/ins-and-outs-of-inlining/">
              <i class="fab fa-facebook-f"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://nianze.tk/2018/02/ins-and-outs-of-inlining/">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://nianze.tk/2018/02/ins-and-outs-of-inlining/">
              <i class="fab fa-google-plus-g"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#utteranc_thread" data-tooltip="Comments">
            <i class="fas fa-comment-dots"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#table-of-contents" data-tooltip="Table of Contents">
            <i class="fas fa-list"></i>
        
          </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="utteranc_thread">
  <script src="https://utteranc.es/client.js"
    repo= "Nianze/personal-site-comments"
    issue-term="pathname"
    theme="github-light"
    label="‚ú®comment üí¨"
    crossorigin="anonymous"
    async>
  </script>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2019 ÂàÄÂøÉ„ÅÆÊ∞¥. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="http://nianze.tk/2018/02/minimize-compilation-dependencies-between-files/" data-tooltip="Item-31 Minimize compilation dependencies between files">
              
                  <i class="fas fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="http://nianze.tk/2018/02/strive-for-exception-safe-code/" data-tooltip="Item-29 Strive for exception-safe code">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fas fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fas fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://nianze.tk/2018/02/ins-and-outs-of-inlining/">
              <i class="fab fa-facebook-f"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://nianze.tk/2018/02/ins-and-outs-of-inlining/">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://nianze.tk/2018/02/ins-and-outs-of-inlining/">
              <i class="fab fa-google-plus-g"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#utteranc_thread" data-tooltip="Comments">
            <i class="fas fa-comment-dots"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#table-of-contents" data-tooltip="Table of Contents">
            <i class="fas fa-list"></i>
        
          </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fas fa-times"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fnianze.tk%2F2018%2F02%2Fins-and-outs-of-inlining%2F">
          <i class="fa fa-facebook-f"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http%3A%2F%2Fnianze.tk%2F2018%2F02%2Fins-and-outs-of-inlining%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http%3A%2F%2Fnianze.tk%2F2018%2F02%2Fins-and-outs-of-inlining%2F">
          <i class="fa fa-google-plus-g"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fas fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="http://nianze.tk/images/bw.JPG" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">ÂàÄÂøÉ„ÅÆÊ∞¥</h4>
    
      <div id="about-card-bio"><p>ËôöÂ∫¶Âªø‰ΩôÂ≤ÅÊúàÊµÖÔºåÁï•ËØÜÂá†Ë°å‰ª£Á†ÅÊ∫ê„ÄÇ<br />
Èó≤Êù•ÈöèÊâãÂø´Èó®ÊåâÔºåÊÄÜÁÑ∂Áã¨ÊääÈü≥ÈüµÂºπ„ÄÇ</p>

<p>Pain is inevitable.<br />
Suffering is optional.</p>
</div>
    
    
      <div id="about-card-job">
        <i class="fas fa-laptop-code"></i>
        <br/>
        Developer
      </div>
    
    
      <div id="about-card-location">
        <i class="fas fa-map-marked-alt"></i>
        <br/>
        New York
      </div>
    
  </div>
</div>

    

    
  
    
      
      <div id="cover" style="background-image:url('http://nianze.tk/images/reservoir.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/3.2.0/imagesloaded.pkgd.min.js"></script>


<script src="http://nianze.tk/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>


  
    <script src="http://nianze.tk/js/loader.js"></script>
  

<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>





    
  </body>
</html>

